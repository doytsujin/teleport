---
title: Server Access Getting Started Guide | Teleport Docs
description: How to use Teleport Server Access with SSH.
---

# Teleport SSH

Teleport Server Access provides full SSH capabilities out-of-the-box:

1. Teleport's `tsh` combines support for SSH and SCP in one convenient, local, a command-line tool.
2. Each Teleport node can be configured into SSH mode (Teleport Node) and run as an enhanced SSH server.

These features can be used without third-party tools (such as OpenSSH) allowing admins to reduce the complexity of their stack. In short, Teleport is a full-fledged SSH server with advanced capabilities no other SSH alternative currently has.

## Introduction to Teleport SSH capabilities

Teleport Server Access provides many great features to manage your servers, sessions, and permissions:

1. **Built-in server authentication**: Teleport Server Access allows full SSH management without third-party dependencies. [Reduce the likelihood of a tool or dependency vulnerability](https://www.cse.usf.edu/~xou/publications/esorics08.pdf) by limiting the number of vendors.
2. **Teleport Server Access provides full SSH capabilities combined with support for 2FA, OAuth 2.0, Open ID Connect, SAML, and SSO out-of-the-box**.
3. The Teleport SSH daemon also offers **several advantages over other SSH alternatives** including [cluster introspection](https://goteleport.com/blog/openssh-vs-teleport/), built-in Role-Based Access Control, Two-Factor Authentication, and multi-user sessions.
4. **Role-Based Access Control (RBAC)**: built-in support for delegating permissions and access by the *Principle of Least Privilege* (POLP).
5. **A convenient web UI** for easily representing and interacting with resources and user sessions.
6. **Multi-cluster management through a graphical user interface or API**.
7. Single and multi-user **session auditing and recording** that can be triggered and sent through defined Events.

<Admonition type="warning" title="Warning">
  The examples below may include the use of the `sudo` keyword to make following each step easier when creating resources from scratch. However, we generally discourage the use of `sudo` in **real-world production environments** per the *Principle of Least Privilege* (POLP). 
</Admonition>

## SSH mode and adding an SSH Node to your cluster

Teleport [Nodes](../../architecture/nodes.mdx) have three modes: *Auth*, *Proxy*, and *Node* (SSH) mode. A single Node can run in up to all three modes. Optionally, you can configure a Node to act as the dedicated *Auth* or SSH Node for a cluster.

<Figure
  align="center"
  bordered
  caption="Example cluster arrangement"
>
  <Image
    alt=""
    height="265"
    src="../../../img/proxy-web.svg"
    unoptimized
    width="581"
  />
</Figure>

The diagram above demonstrates a common cluster arrangement with three independent nodes acting in a single, dedicated, mode each.

### Configuration

The two primary ways a Node can be configured into SSH (or any) mode is through a `teleport.yaml` configuration file or via the `sudo tctl tokens add` command which accepts the `--type` parameter to specify which of `auth`, `proxy`, or `node` (default) the Node will be automatically configured as.

In both cases, you'll likely use a *static* (fixed) or *dynamic* (valid for a limited duration of time) [join token](../../admin-guide.mdx#adding-nodes-to-the-cluster) to link your Nodes to existing clusters.

To link an SSH Node with an existing `auth.example.com` cluster:

1. Execute `sudo tctl tokens add --type=node` on the `auth` cluster machine.

   - Save the resultant `token` value to a token-specific directory of your choice. For example: `/tmp/token`. 
   - This helps to minimize the direct sharing of tokens even when they are *dynamically* generated.

2. Your console will display the following message format: 

   ```bash
   # Join cluster
   sudo teleport start \
      --roles=node \
      --token=/tmp/token \
      --ca-pin=sha256:c75f8be5b21a5cc1b6f91a71200f30a9a083dfea4fc47ec1c55143ccce8882e4 \
      --auth-server=172.31.17.124:3025
   ``` 

3. Run the command above with the correct `auth.example.com` public proxy address on the machine you wish to connect.

   - This second machine (and its Node) need not publically exposed (per the best-practice *Bastion pattern*).

4. You should now be able to view both Nodes at: `https://auth.example.com/web/cluster/auth.example.com/nodes` in the Web Interface after logging in with your user `auth-admin`.

   <Figure
     align="center"
     bordered
     caption="Both Nodes in the Web UI"
   >
     <Image
       alt=""
       height="265"
       src="../../../img/server-access/teleport_ui.png"
       unoptimized
       width="581"
     />
   </Figure>


## Connect to a cluster using tsh ssh without OpenSSH

Teleport SSH is robust enough that you can do all the things you'd do with OpenSSH, without it.

To connect to a cluster (`auth.example.com`) with public proxy `auth.example.com:443` as user `auth-admin` using `tsh ssh`:

1. `tsh login --proxy=auth.example.com:443 --user=auth-admin`  

2. You'll be prompted to enter the password and One Time Passcode we set up previously.

3. Your user will now see:

   ```bash
   Profile URL:        https://auth.example.com:443
     Logged in as:       auth-admin
     Cluster:            auth.example.com
     Roles:              access, editor
     Logins:             root, ubuntu, ec2-user
     Kubernetes:         disabled
     Valid until:        2021-04-30 06:39:13 -0500 CDT [valid for 12h0m0s]
     Extensions:         permit-agent-forwarding, permit-port-forwarding, permit-pty
   ```

   `auth-admin` is now logged into the `auth.example.com` cluster and `auth` Node via Teleport SSH - no third-party tool required.

4. `auth-admin` can now execute the following to find the cluster's `nodenames` which are used for connecting through SSH:

   i. `tctl nodes ls`  
   ii. The `auth` node is located on the bottom line below:

   ```bash
   Nodename         UUID                                 Address        Labels                                
   ---------------- ------------------------------------ -------------- ------------------------------------- 
   ip-172-31-30-155 8f1e2719-3161-400f-b664-3279cf046511                env=example,hostname=ip-172-31-30-155 
   ip-172-31-17-124 e7719967-b6eb-4fc0-8e53-00fac6d896d4 127.0.0.1:3022 env=example,hostname=ip-172-31-17-124 
   ```

5. Using the command `tsh ssh root@ip-172-31-17-124` locally, `auth-admin` can SSH into the `auth` Node and do the following:

   i. Connect to other Nodes in the cluster by repeating the steps above.  
   ii. Traverse the Linux file system.  
   iii. Execute desired commands.  

   - All commands executed by `auth-admin` are recorded and can be replayed in the Teleport Web interface.
   - The `tsh ssh` command allows one to do anything they would if they were to SSH into a server using a third-party tool. Compare the two equivalent commands:

<Tabs>
  <TabItem label="tsh">
    ```bash
    tsh ssh root@ip-172-31-17-124
    ```
  </TabItem>
  <TabItem label="ssh">
    ```bash
    ssh -J tele.example.com user@host
    ```
  </TabItem>
</Tabs>

## Audit user and SSH sessions

Teleport Server Access has built-in [session auditing](../../features/enhanced-session-recording.mdx) that will record single and joint user interactions in both audit log and video formats.

- When a user authenticates and performs commands through `tsh ssh`, their activities are recorded in replayable session videos that can be viewed in Teleport Web UI.
- Session recording captures each keystroke and command-line output.
- Multiuser session auditing is also provided out-of-the-box. You can record remote IT sessions and administrative tasks without additional configuration.

<video autoplay loop muted playsinline>
  <source src="https://goteleport.com/teleport/videos/server-access/replay.mp4" type="video/mp4"/>
  <source src="https://goteleport.com/teleport/videos/server-access/replay.webm" type="video/webm"/>
Your browser does not support the video tag.
</video>

## Define, approve, and deny access requests

Teleports allows you to define [roles and permissions](../../access-controls/reference.mdx) in line with the best practice *Principle of Least Privilege* (POLP).

Each role is permitted or disallowed to interact with resources in specific ways via allow-rules. For example, a user may be granted super-user authority to manage session events: 

```yaml
rules:
- resources: [event]
  verbs: [list, create, read, update, delete]
```

Roles and permissions can be further defined to allow **making and denying role requests** themselves. Such users are typically Teleport administrators:

```yaml
request:
  roles:
  - dba
  - admin
```

Users can then request a role through `tsh`:

1. A user logins into `teleport-cluster` and requests the `admin` role: `tsh login teleport-cluster --request-roles=admin`.
2. This will generate a unique request token identifying the request, requested role, and user.

  - `Seeking request approval... (id: bc8ca931-fec9-4b15-9a6f-20c13c5641a9)`

3. A Teleport admin can approve or deny their request from within the Teleport Web UI or through [tctl](../../cli-docs.mdx#tctl-request-ls):

  - `tctl request ls`
  - `tctl request approve [token]`
  - `tctl request deny [token]`

As such, Teleport allows organizations to include complex [access request workflows](../../enterprise/workflow/index.mdx) directly within their primary SSH and authentication tool.

## Introspect and manage the cluster 

Teleport `tctl` ("tea-kettle") has powerful querying and multi-command capabilities to make inspecting and managing a cluster even easier.

1. Execute `sudo tctl nodes ls` to display the Universal Resource Catalog with all queried resources in one view:
   
   ```bash
   Nodename         UUID                                 Address            Labels                               
   ---------------- ------------------------------------ ------------------ ------------------------------------ 
   ip-172-31-40-99  bf840c02-68f4-4fac-a9e6-30141e82d242 127.0.0.1:3022     env=example,hostname=ip-172-31-40-99 
   ip-172-31-39-190 d32945f4-6e35-4318-b8f6-198d7c1fbd4c 172.31.39.190:3022                                      
   ```

   Note the "Labels" column on the farthest side.

2. Teleport admins can define `labels` for any Node to easily group resources beyond cluster management alone.

3. These [labels](../../admin-guide.mdx#labeling-nodes-and-applications) can be used to query any resource sharing them: 

   - `tsh ssh root@env=example` returns the list of all resources with the `env=example` label specified in their `teleport.yaml` (`'env': 'example'`).
   - Suppose an IP address changes, an admin can quickly find the current Node with that label since it remains unchanged.
   - Suppose you need to query the SSH Node of each cluster. Give each SSH Node the same label so a single query will allow you to introspect specific resources in multiple clusters.

### Multi-querying

`tctl` also supports multi-querying: the ability to execute sequential (or simultaneous) commands on multiple resources at once. 

   - `tsh ssh root@env=example ls` will execute the `ls` command on each Node displaying the contents of each to the screen.

As a consequence, Teleport admins can execute commands on all Nodes that share a label vastly simplifying repeated operations. 

### Progammatic interaction 

Teleport Auth Nodes expose an API through gRPC to allow for [programmatic interaction](../../reference/api.mdx) with its underlying functionalities beyond the command-line.

Teleport clients communicate with clusters by connecting to Teleport Auth Nodes and authenticate using short-lived certificates and Teleport [roles](../../access-controls/reference.mdx).

This requires:

1. A suitable client written in your favorite language.
2. Provisioning valid TLS (SSL) certificates.
3. Supplying the correct roles, permissions, and/or short-lived certificates to the appropriate users.

Review the `client` [pkg.go reference documentation](https://pkg.go.dev/github.com/gravitational/teleport/api/client) for more information about working with the Teleport API programmatically.

<Admonition type="tip" title="Tip">
  The Getting Started Guide walks through a [quick and easy](../getting-started.mdx) Go example demonstrating these features.
</Admonition>